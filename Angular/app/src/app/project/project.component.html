<h1>Page projets</h1>

<button class="btn btn-primary" (click)="toggleOffcanvas(); getProjects()">Mes Projets</button>
<div class="offcanvas offcanvas-start" tabindex="-1" id="myOffCanvas" aria-labelledby="myOffCanvas">
   <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="myOffCanvas">Mes Projets</h5>
      <button type="button" class="btn-close" (click)="toggleOffcanvas()" aria-label="Close"></button>
   </div>
   <div class="offcanvas-body">
      <div *ngFor="let project of projects" class="d-flex justify-content-between align-items-center">
         <h5 (click)="closeOffcanvas(); getProjectTasks(project.id); getProjectId(project.id)">{{ project.name }}</h5>
         <div>
            <div div type="button" class="btn btn-success" (click)="toggleUpdateForm(); editProject(project.id)">
               <i class="bi bi-pencil-fill"></i>
            </div>
            <div type="button" class="btn btn-danger" (click)="deleteProject(project.id)">
               <i class="bi bi-trash-fill"></i>
            </div>
         </div>
      </div>

   </div>
   
   <div *ngIf="!addForm" type="button" class="btn btn-primary" (click)="toggleAddForm()">
      <i class="bi bi-plus-lg"></i>
   </div>

    <!-- Affichage du formulaire d'ajout de projet -->
    <ng-container *ngIf="addForm">
      <form class="form mx-auto" #projectForm="ngForm">
         
         <div class="input-group mb-3">
            <span class="input-group-text" id="projectName">Nom</span>
            <input
            type="text"
            class="form-control"
            placeholder="POEC Java"
            aria-label="Nom du projet"
            aria-describedby="projectName"
            [(ngModel)]="projectName"
            name="projectName"
            />
         </div>
         <button type="button" class="btn btn-primary" (click)="addProject(projectName)">Ajouter</button>
      </form>
   </ng-container>

   <!-- Affichage du formulaire de modification de projet -->
   <ng-container *ngIf="updateForm">
      <form class="form mx-auto" #projectForm="ngForm">
         
         <div class="input-group mb-3">
            <span class="input-group-text" id="projectName">Nom</span>
            <input
            type="text"
            class="form-control"
            placeholder="POEC Java"
            aria-label="Nom du projet"
            aria-describedby="projectName"
            [(ngModel)]="projectName"
            name="projectName"
            />
         </div>
         <button type="button" class="btn btn-primary addProject" (click)="addProject(projectName)">Modifier</button>
      </form>
   </ng-container>
</div>

<!-- Partie pour l'affichage des tâches en drag and drop -->
<div class="row wrapper d-flex justify-content-center">

   <!--  COLONNE À FAIRE -->
   <div class="col-xs-6 col-6 col-md-6 col-lg-3 col-xxl-3 m-2 status">
      <h2>À faire</h2>
      <bs-sortable
         [(ngModel)]="todo"
         fieldName="title"
         itemClass="sortable-item"
         itemActiveClass="sortable-item-active"
         placeholderItem="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"
         placeholderClass="placeholderStyle text-center"
         wrapperClass="sortable-wrapper"
         [itemTemplate]="taskTemplate"   
      >
      </bs-sortable>
   </div>

   <!-- COLONNE EN COURS -->
   <div class="col-xs-6 col-6 col-md-6 col-lg-3 col-xxl-3 m-2 status">
      <h2>En cours</h2>
      <bs-sortable
         [(ngModel)]="ongoing"
         fieldName="title"
         itemClass="sortable-item"
         itemActiveClass="sortable-item-active"
         placeholderItem="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"
         placeholderClass="placeholderStyle text-center"
         wrapperClass="sortable-wrapper"
         [itemTemplate]="taskTemplate"
      >
      </bs-sortable>
   </div>

   <!-- COLONNE TERMINÉ -->
   <div class="col-xs-6 col-6 col-md-6 col-lg-3 col-xxl-3 m-2 status">
      <h2>Terminé</h2>
      <bs-sortable
         [(ngModel)]="done"
         fieldName="title"
         itemClass="sortable-item"
         itemActiveClass="sortable-item-active"
         placeholderItem="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"
         placeholderClass="placeholderStyle text-center"
         wrapperClass="sortable-wrapper"
         [itemTemplate]="taskTemplate"
      >
      </bs-sortable>
   </div>
   
   <ng-template #taskTemplate let-item="item" let-index="index">
      <div class="d-flex justify-content-between align-items-center">
         <div>{{ item.initData.title }}</div>
         
         <!-- Bouton visualisation des détails de la tâche -->
         <div type="button" class="btn btn-info" (click)="getTaskDetails(item.initData.id)">
            <i class="bi bi-eye-fill taskDetail"></i>
         </div>
   
         <!-- Bouton pour modifier la tâche -->
         <div type="button" routerLink="/task/update" class="btn btn-success">
            <i class="bi bi-pencil-fill"></i>
         </div>
   
         <!-- Bouton pour supprimer la tâche -->
         <div type="button" class="btn btn-danger" (click)="deleteTask(item.initData.id)">
            <i class="bi bi-trash-fill"></i>
         </div>
      </div>
   </ng-template>
 
   <ng-container *ngIf="showTaskForm">
      <div class="container">
         <form
            class="form mx-auto col-sm-12 col-md-10 col-lg-10 col-xl-8 col-xxl-6"
            #addTask="ngForm"
         >
      
         <!-- Title -->
         <div class="input-group mb-3">
            <span class="input-group-text taskActions" id="taskTitle">Titre</span>
            <input
              type="text"
              class="form-control"
              placeholder="Acheter du pain..."
              aria-label="Acheter du pain..."
              aria-describedby="taskTitle"
              [(ngModel)]="title"
              name="title"
              required
            />
         </div>
      
         <!-- Description -->
         <div class="input-group mb-3">
            <span class="input-group-text taskActions" id="taskDescription"
              >Description</span
            >
            <textarea
              class="form-control"
              placeholder="Description de la tâche..."
              aria-label="With textarea"
              name="description"
              [(ngModel)]="description"
            ></textarea>
         </div>
      
         <!-- Status -->
         <div class="input-group mb-3">
            <label class="input-group-text taskActions" for="taskStatus"
              >Statut</label
            >
            <select
              class="form-select"
              id="taskStatus"
              name="status"
              [(ngModel)]="status"
            >
              <option value="TODO">À faire</option>
              <option value="ONGOING">En cours</option>
              <option value="DONE">Terminé</option>
            </select>
         </div>
      
         <!-- Estimated hours -->
         <div class="input-group mb-3">
            <span class="input-group-text taskActions" id="estimatedHours"
              >Temps estimé (en heures)</span
            >
            <input
              type="number"
              class="form-control"
              placeholder="1"
              aria-label="Temps estimé"
              aria-describedby="estimatedHours"
              name="estimation"
              [(ngModel)]="estimation"
            />
         </div>
         
         <div class="d-flex justify-content-end">
            <button
              type="submit"
              class="btn btn-primary btn-lg addTask"
              (click)="submit()"
            >
              &#43;
            </button>
         </div>
        </form>
      </div>
   </ng-container>
 </div>